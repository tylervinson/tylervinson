<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacy Finder</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_lP5NeY2aU2pHP79V0sx3wc6F8tQRRIk&libraries=places"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            background-color: #f4f4f4;
        }

        #inputContainer {
            margin-bottom: 10px;
            text-align: center;
        }

        #inputContainer input, #inputContainer button {
            padding: 10px;
            font-size: 16px;
            margin: 5px;
        }

        #container {
            display: flex;
            width: 90%;
            height: 80%;
            max-width: 1200px;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        #map {
            width: 70%;
            height: 100%;
        }

        #pharmacyListContainer {
            width: 30%;
            overflow-y: auto;
            padding: 20px;
            background-color: #fafafa;
            border-left: 1px solid #ddd;
        }

        #pharmacyListContainer h3 {
            margin-top: 0;
        }

        .pharmacy-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }

        .pharmacy-item:hover {
            background-color: #f0f0f0;
        }

    </style>
</head>
<body>
    <div id="inputContainer">
        <input type="text" id="zipCode" placeholder="Enter ZIP Code">
        <button onclick="findPharmacies()">Find Pharmacies</button>
    </div>

    <div id="container">
        <div id="map"></div>
        <div id="pharmacyListContainer">
            <h3>Nearby Pharmacies</h3>
            <div id="pharmacyList"></div>
        </div>
    </div>

    <script>
        let map;
        let service;
        let infowindow;
        const markers = [];

        function initializeMap(lat, lng) {
            const location = new google.maps.LatLng(lat, lng);

            map = new google.maps.Map(document.getElementById('map'), {
                center: location,
                zoom: 13
            });

            infowindow = new google.maps.InfoWindow();
        }

        function loadDefaultMap() {
            const phoenixLatLng = { lat: 33.4484, lng: -112.0740 }; // Phoenix, Arizona
            initializeMap(phoenixLatLng.lat, phoenixLatLng.lng);
        }

        function findPharmacies() {
            const zipCode = document.getElementById('zipCode').value;

            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ 'address': zipCode }, function(results, status) {
                if (status == 'OK') {
                    const lat = results[0].geometry.location.lat();
                    const lng = results[0].geometry.location.lng();

                    initializeMap(lat, lng);

                    const location = new google.maps.LatLng(lat, lng);
                    const request = {
                        location: location,
                        radius: '8046.72',
                        type: ['pharmacy']
                    };

                    service = new google.maps.places.PlacesService(map);
                    service.nearbySearch(request, handleSearchResults);
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        function handleSearchResults(results, status) {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
                const pharmacyList = document.getElementById('pharmacyList');
                pharmacyList.innerHTML = '';

                results.forEach((place, index) => {
                    const marker = createMarker(place);
                    markers.push(marker);

                    const pharmacyItem = document.createElement('div');
                    pharmacyItem.className = 'pharmacy-item';
                    pharmacyItem.textContent = `${place.name} - ${place.vicinity}`;
                    pharmacyItem.addEventListener('click', () => {
                        map.panTo(marker.getPosition());
                        map.setZoom(14);
                        infowindow.setContent(place.name);
                        infowindow.open(map, marker);
                    });

                    pharmacyItem.addEventListener('mouseover', () => {
                        marker.setAnimation(google.maps.Animation.BOUNCE);
                    });

                    pharmacyItem.addEventListener('mouseout', () => {
                        marker.setAnimation(null);
                    });

                    pharmacyList.appendChild(pharmacyItem);
                });
            }
        }

        function createMarker(place) {
            const marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location
            });

            google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent(place.name);
                infowindow.open(map, this);
            });

            return marker;
        }

        // Load the default map centered on Phoenix, AZ
        window.onload = loadDefaultMap;
    </script>
</body>
</html>
