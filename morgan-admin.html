<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Upload Project - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#5B9A9E",
                        "primary-dark": "#4A8287",
                    },
                    fontFamily: {
                        "sans": ["Inter", "sans-serif"]
                    }
                }
            }
        }
    </script>
    <style>
        .tab-button {
            border-color: transparent;
            color: #6B7280;
        }
        .tab-button.active {
            border-color: #5B9A9E !important;
            color: #5B9A9E !important;
        }
        .tab-button:hover:not(.active) {
            color: #374151;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="min-h-screen flex flex-col">
        <!-- Header - Fixed at top -->
        <div class="text-center py-8 bg-white border-b border-gray-200">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Portfolio Management</h1>
            <p class="text-gray-600">Update your portfolio content and add projects</p>
        </div>

        <!-- Tabs - Sticky below header -->
        <div class="sticky top-0 bg-white border-b border-gray-200 shadow-sm z-10">
            <div class="max-w-4xl mx-auto">
                <nav class="flex -mb-px">
                    <button onclick="switchTab('content')" id="contentTab" class="tab-button active flex-1 py-4 px-6 text-sm font-semibold border-b-2">
                        Portfolio Content
                    </button>
                    <button onclick="switchTab('upload')" id="uploadTab" class="tab-button flex-1 py-4 px-6 text-sm font-semibold border-b-2">
                        Upload Project
                    </button>
                    <button onclick="switchTab('manage')" id="manageTab" class="tab-button flex-1 py-4 px-6 text-sm font-semibold border-b-2">
                        Manage Projects
                    </button>
                </nav>
            </div>
        </div>

        <!-- Content Area - Fixed height -->
        <div class="flex-1 py-8 px-4">
            <div class="max-w-2xl mx-auto">
                <!-- Content Tab -->
                <div id="contentSection" class="bg-white rounded-2xl shadow-lg p-8 min-h-[600px]">
                <h2 class="text-xl font-bold text-gray-900 mb-6">Update Portfolio Text</h2>
                
                <form id="contentForm" class="space-y-6">
                    <div>
                        <label for="heroHeading" class="block text-sm font-semibold text-gray-700 mb-2">
                            Hero Heading
                        </label>
                        <input 
                            type="text" 
                            id="heroHeading"
                            placeholder="e.g., Welcome to my portfolio!"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                        />
                        <p class="text-xs text-gray-500 mt-1">Main title at the top of your portfolio</p>
                    </div>

                    <div>
                        <label for="heroSubheading" class="block text-sm font-semibold text-gray-700 mb-2">
                            Hero Subheading
                        </label>
                        <input 
                            type="text" 
                            id="heroSubheading"
                            placeholder="e.g., Aspiring Software Engineer focused on building innovative solutions."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                        />
                        <p class="text-xs text-gray-500 mt-1">Subtitle describing what you do</p>
                    </div>

                    <div>
                        <label for="aboutText" class="block text-sm font-semibold text-gray-700 mb-2">
                            About Me Text
                        </label>
                        <textarea 
                            id="aboutText"
                            rows="6"
                            placeholder="Write a few paragraphs about yourself..."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition resize-none"
                        ></textarea>
                        <p class="text-xs text-gray-500 mt-1">Bio that appears in the About Me section</p>
                    </div>

                    <div id="contentStatus" class="hidden p-4 rounded-lg"></div>

                    <button 
                        type="submit" 
                        id="contentBtn"
                        class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-4 px-6 rounded-lg 
                               transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed
                               flex items-center justify-center gap-2"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span>Update Portfolio Content</span>
                    </button>
                </form>
            </div>

            <!-- Upload Tab -->
            <div id="uploadSection" class="bg-white rounded-2xl shadow-lg p-8 min-h-[600px] hidden">
                <h2 class="text-xl font-bold text-gray-900 mb-6">Upload New Project</h2>
                
                <form id="uploadForm" class="space-y-6">
                    <div>
                        <label for="projectTitle" class="block text-sm font-semibold text-gray-700 mb-2">
                            Project Title *
                        </label>
                        <input 
                            type="text" 
                            id="projectTitle" 
                            required
                            placeholder="e.g., Research on Neural Networks"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                        />
                    </div>
                    
                    <div>
                        <label for="projectDesc" class="block text-sm font-semibold text-gray-700 mb-2">
                            Description *
                        </label>
                        <textarea 
                            id="projectDesc" 
                            required 
                            rows="4"
                            placeholder="Describe what this project is about..."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition resize-none"
                        ></textarea>
                    </div>
                    
                    <div>
                        <label for="projectTags" class="block text-sm font-semibold text-gray-700 mb-2">
                            Tags (comma-separated)
                        </label>
                        <input 
                            type="text" 
                            id="projectTags"
                            placeholder="e.g., Python, Machine Learning, Research"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                        />
                        <p class="text-xs text-gray-500 mt-1">Optional - separate multiple tags with commas</p>
                    </div>
                    
                    <div>
                        <label for="pdfFile" class="block text-sm font-semibold text-gray-700 mb-2">
                            PDF File *
                        </label>
                        <div class="relative">
                            <input 
                                type="file" 
                                id="pdfFile" 
                                accept=".pdf" 
                                required
                                class="w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer
                                       file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 
                                       file:text-sm file:font-semibold file:bg-primary file:text-white
                                       hover:file:bg-primary-dark file:cursor-pointer
                                       hover:border-primary transition"
                            />
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Maximum file size: 10MB</p>
                    </div>

                    <!-- Status Messages -->
                    <div id="uploadStatus" class="hidden rounded-lg p-4"></div>

                    <!-- Progress Bar -->
                    <div id="progressContainer" class="hidden">
                        <div class="mb-2 flex justify-between items-center">
                            <span class="text-sm font-medium text-gray-700" id="progressText">Uploading...</span>
                            <span class="text-sm font-medium text-gray-700" id="progressPercent">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="progressBar" class="bg-primary h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <button 
                        type="submit" 
                        id="uploadBtn"
                        class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-4 px-6 rounded-lg 
                               transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed
                               flex items-center justify-center gap-2"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <span id="uploadBtnText">Upload to Portfolio</span>
                    </button>
                </form>

                <!-- Success Message -->
                <div id="successMessage" class="hidden mt-6 p-6 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-start gap-3">
                        <svg class="w-6 h-6 text-green-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-green-900 mb-1">Upload Successful! üéâ</h3>
                            <p class="text-green-700 text-sm mb-3">Your project has been added to the portfolio.</p>
                            <button 
                                onclick="resetForm()" 
                                class="text-sm font-medium text-green-700 hover:text-green-800 underline"
                            >
                                Upload Another Project
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manage Projects Tab -->
            <div id="manageSection" class="bg-white rounded-2xl shadow-lg p-8 min-h-[600px] hidden">
                <h2 class="text-xl font-bold text-gray-900 mb-2">Manage Projects</h2>
                <p class="text-gray-600 text-sm mb-6">View and delete projects from your portfolio</p>
                
                <div id="manageStatus" class="hidden p-4 rounded-lg mb-4"></div>
                
                <div id="projectsList" class="space-y-4">
                    <p class="text-gray-500 text-center py-8">Loading projects...</p>
                </div>
            </div>
            </div>
        </div>

        <!-- Link back to portfolio - Fixed at bottom -->
        <div class="text-center py-6 border-t border-gray-200 bg-white">
            <a href="morgan-vinson-portfolio.html" class="text-sm text-gray-600 hover:text-primary transition">
                ‚Üê Back to Portfolio
            </a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configure PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

       // =================================================================
        // ENCRYPTED GITHUB CONFIGURATION
        // =================================================================
        // The token is encrypted. Your wife enters a password to decrypt it.
        // Password: (you'll set this below)
        const ENCRYPTED_CONFIG = {
            encryptedToken: 'CgcCODEAVRoKNQghLBYfV1EqKRpFNVUNBFYFPzIEKgQYAFVWWwYrLA==',  // Will be replaced
            repo: 'tylervinson/tylervinson',
            branch: 'main',
            password: null  // Will be set after user enters it
        };
        // =================================================================

        // Simple encryption/decryption functions
        function encryptToken(token, password) {
            // Simple XOR encryption (not super secure but prevents casual viewing)
            let result = '';
            for (let i = 0; i < token.length; i++) {
                result += String.fromCharCode(token.charCodeAt(i) ^ password.charCodeAt(i % password.length));
            }
            return btoa(result); // Base64 encode
        }

        function decryptToken(encrypted, password) {
            try {
                const decoded = atob(encrypted); // Base64 decode
                let result = '';
                for (let i = 0; i < decoded.length; i++) {
                    result += String.fromCharCode(decoded.charCodeAt(i) ^ password.charCodeAt(i % password.length));
                }
                return result;
            } catch (e) {
                return null;
            }
        }

        // Get GitHub config (decrypt token if needed)
        function getGitHubConfig() {
            if (!ENCRYPTED_CONFIG.password) {
                return null;
            }
            
            const token = decryptToken(ENCRYPTED_CONFIG.encryptedToken, ENCRYPTED_CONFIG.password);
            if (!token || !token.startsWith('ghp_')) {
                return null;
            }
            
            return {
                token: token,
                repo: ENCRYPTED_CONFIG.repo,
                branch: ENCRYPTED_CONFIG.branch
            };
        }

        // Prompt for password on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if password is already saved in session
            const savedPassword = sessionStorage.getItem('adminPassword');
            
            if (savedPassword) {
                ENCRYPTED_CONFIG.password = savedPassword;
                const config = getGitHubConfig();
                if (config) {
                    loadExistingContent();
                    return;
                }
            }
            
            // Prompt for password
            const password = prompt('Enter admin password:');
            if (!password) {
                alert('Password required to access admin panel');
                window.location.href = 'morgan-vinson-portfolio.html';
                return;
            }
            
            ENCRYPTED_CONFIG.password = password;
            const config = getGitHubConfig();
            
            if (!config) {
                alert('Incorrect password');
                window.location.href = 'morgan-vinson-portfolio.html';
                return;
            }
            
            // Save password for this session
            sessionStorage.setItem('adminPassword', password);
            loadExistingContent();
        });

        // Tab switching
        function switchTab(tab) {
            const contentSection = document.getElementById('contentSection');
            const uploadSection = document.getElementById('uploadSection');
            const manageSection = document.getElementById('manageSection');
            const contentTab = document.getElementById('contentTab');
            const uploadTab = document.getElementById('uploadTab');
            const manageTab = document.getElementById('manageTab');

            // Hide all sections
            contentSection.classList.add('hidden');
            uploadSection.classList.add('hidden');
            manageSection.classList.add('hidden');
            
            // Remove active from all tabs
            contentTab.classList.remove('active');
            uploadTab.classList.remove('active');
            manageTab.classList.remove('active');

            // Show selected section
            if (tab === 'content') {
                contentSection.classList.remove('hidden');
                contentTab.classList.add('active');
            } else if (tab === 'upload') {
                uploadSection.classList.remove('hidden');
                uploadTab.classList.add('active');
            } else if (tab === 'manage') {
                manageSection.classList.remove('hidden');
                manageTab.classList.add('active');
                loadProjectsForManagement();
            }
        }

        // Load existing content on page load
        document.addEventListener('DOMContentLoaded', loadExistingContent);

        async function loadExistingContent() {
            const GITHUB_CONFIG = getGitHubConfig();
            if (!GITHUB_CONFIG) return;

            try {
                const url = `https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/portfolio-content.json?ref=${GITHUB_CONFIG.branch}`;
                const response = await fetch(url, {
                    headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const content = JSON.parse(atob(data.content));
                    
                    document.getElementById('heroHeading').value = content.heroHeading || '';
                    document.getElementById('heroSubheading').value = content.heroSubheading || '';
                    document.getElementById('aboutText').value = content.aboutText || '';
                }
            } catch (error) {
                console.log('No existing content found');
            }
        }

        // Content form submission
        document.getElementById('contentForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const GITHUB_CONFIG = getGitHubConfig();
            if (!GITHUB_CONFIG) {
                showContentStatus('‚ö†Ô∏è Configuration error. Please reload the page and enter your password.', 'error');
                return;
            }

            const contentBtn = document.getElementById('contentBtn');
            contentBtn.disabled = true;

            try {
                const content = {
                    heroHeading: document.getElementById('heroHeading').value,
                    heroSubheading: document.getElementById('heroSubheading').value,
                    aboutText: document.getElementById('aboutText').value,
                    lastUpdated: new Date().toISOString()
                };

                await updateContentJSON(content, GITHUB_CONFIG);
                showContentStatus('‚úì Portfolio content updated successfully! Changes will appear in ~1 minute.', 'success');
            } catch (error) {
                showContentStatus('Error: ' + error.message, 'error');
            } finally {
                contentBtn.disabled = false;
            }
        });

        async function updateContentJSON(content, config) {
            const url = `https://api.github.com/repos/${config.repo}/contents/portfolio-content.json`;
            
            let currentSHA = null;
            
            // Get current file SHA if it exists
            try {
                const response = await fetch(url + `?ref=${config.branch}`, {
                    headers: { 'Authorization': `token ${config.token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentSHA = data.sha;
                }
            } catch (e) {
                // File doesn't exist yet
            }
            
            // Upload updated file
            const newContent = btoa(JSON.stringify(content, null, 2));
            
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: 'Update portfolio content',
                    content: newContent,
                    sha: currentSHA,
                    branch: config.branch
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`Failed to update content: ${error.message}`);
            }
        }

        function showContentStatus(message, type) {
            const statusDiv = document.getElementById('contentStatus');
            
            const colors = {
                success: 'bg-green-50 text-green-800 border border-green-200',
                error: 'bg-red-50 text-red-800 border border-red-200',
            };
            
            statusDiv.className = `p-4 rounded-lg ${colors[type] || colors.error}`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
            
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 7000);
        }

        // Upload form submission handler
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const GITHUB_CONFIG = getGitHubConfig();
            if (!GITHUB_CONFIG) {
                showStatus('‚ö†Ô∏è Configuration error. Please reload the page and enter your password.', 'error');
                return;
            }
            
            const title = document.getElementById('projectTitle').value;
            const description = document.getElementById('projectDesc').value;
            const tags = document.getElementById('projectTags').value;
            const fileInput = document.getElementById('pdfFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showStatus('Please select a PDF file', 'error');
                return;
            }

            // Check file size (10MB limit)
            if (file.size > 10 * 1024 * 1024) {
                showStatus('File is too large. Maximum size is 10MB.', 'error');
                return;
            }
            
            // Disable form
            const submitBtn = document.getElementById('uploadBtn');
            submitBtn.disabled = true;
            document.getElementById('uploadForm').classList.add('opacity-50', 'pointer-events-none');
            
            try {
                await uploadToGitHub(file, title, description, tags, GITHUB_CONFIG);
            } catch (error) {
                showStatus('Upload failed: ' + error.message, 'error');
                console.error('Upload error:', error);
            } finally {
                submitBtn.disabled = false;
                document.getElementById('uploadForm').classList.remove('opacity-50', 'pointer-events-none');
            }
        });

        async function uploadToGitHub(file, title, description, tags, config) {
            updateProgress(0, 'Reading PDF file...');
            
            // Convert file to base64
            const pdfBase64 = await fileToBase64(file);
            const pdfContent = pdfBase64.split(',')[1];
            
            updateProgress(25, 'Generating thumbnail...');
            
            // Generate thumbnail
            const thumbnail = await generatePDFThumbnail(file);
            
            // Create safe filenames
            const timestamp = Date.now();
            const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
            const pdfPath = `pdfs/${timestamp}_${safeName}`;
            
            updateProgress(40, 'Uploading PDF to repository...');
            
            // Upload PDF
            await uploadFileToGitHub(pdfPath, pdfContent, `Add PDF: ${title}`, config);
            
            // Upload thumbnail
            let thumbnailPath = null;
            if (thumbnail) {
                updateProgress(60, 'Uploading thumbnail...');
                thumbnailPath = `thumbnails/${timestamp}_${safeName.replace('.pdf', '.jpg')}`;
                const thumbnailContent = thumbnail.split(',')[1];
                await uploadFileToGitHub(thumbnailPath, thumbnailContent, `Add thumbnail for: ${title}`, config);
            }
            
            updateProgress(80, 'Updating projects list...');
            
            // Create project object
            const project = {
                id: timestamp,
                title: title,
                description: description,
                tags: tags ? tags.split(',').map(t => t.trim()) : ['PDF'],
                pdfUrl: pdfPath,
                thumbnailUrl: thumbnailPath,
                uploadDate: new Date().toISOString().split('T')[0]
            };
            
            // Update projects.json
            await updateProjectsJSON(project, config);
            
            updateProgress(100, 'Complete!');
            
            // Show success
            setTimeout(() => {
                document.getElementById('progressContainer').classList.add('hidden');
                document.getElementById('successMessage').classList.remove('hidden');
                document.getElementById('uploadForm').classList.add('hidden');
            }, 500);
        }

        async function uploadFileToGitHub(path, content, message, config) {
            const url = `https://api.github.com/repos/${config.repo}/contents/${path}`;
            
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: message,
                    content: content,
                    branch: config.branch
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`GitHub API error: ${error.message || response.statusText}`);
            }
            
            return await response.json();
        }

        async function updateProjectsJSON(newProject, config) {
            const url = `https://api.github.com/repos/${config.repo}/contents/projects.json`;
            
            let currentSHA = null;
            let currentProjects = [];
            
            // Get current file
            try {
                const response = await fetch(url + `?ref=${config.branch}`, {
                    headers: {
                        'Authorization': `token ${config.token}`,
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentSHA = data.sha;
                    const content = atob(data.content);
                    currentProjects = JSON.parse(content);
                }
            } catch (e) {
                // File doesn't exist yet
            }
            
            // Add new project
            currentProjects.push(newProject);
            
            // Upload updated file
            const newContent = btoa(JSON.stringify(currentProjects, null, 2));
            
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: `Add project: ${newProject.title}`,
                    content: newContent,
                    sha: currentSHA,
                    branch: config.branch
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(`Failed to update projects.json: ${error.message}`);
            }
        }

        async function generatePDFThumbnail(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                const page = await pdf.getPage(1);
                
                const viewport = page.getViewport({ scale: 1.5 });
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                
                await page.render({ canvasContext: context, viewport }).promise;
                return canvas.toDataURL('image/jpeg', 0.8);
            } catch (error) {
                console.error('Thumbnail generation failed:', error);
                return null;
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function updateProgress(percent, text) {
            const container = document.getElementById('progressContainer');
            const bar = document.getElementById('progressBar');
            const percentText = document.getElementById('progressPercent');
            const progressText = document.getElementById('progressText');
            
            container.classList.remove('hidden');
            bar.style.width = percent + '%';
            percentText.textContent = percent + '%';
            progressText.textContent = text;
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('uploadStatus');
            
            const colors = {
                success: 'bg-green-50 text-green-800 border border-green-200',
                error: 'bg-red-50 text-red-800 border border-red-200',
                info: 'bg-blue-50 text-blue-800 border border-blue-200'
            };
            
            statusDiv.className = `p-4 rounded-lg ${colors[type] || colors.info}`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
            
            if (type !== 'info') {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 7000);
            }
        }

        function resetForm() {
            document.getElementById('uploadForm').reset();
            document.getElementById('uploadForm').classList.remove('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('progressContainer').classList.add('hidden');
            document.getElementById('uploadStatus').classList.add('hidden');
        }

        // ===================================================================
        // MANAGE PROJECTS FUNCTIONS
        // ===================================================================

        async function loadProjectsForManagement() {
            const GITHUB_CONFIG = getGitHubConfig();
            if (!GITHUB_CONFIG) {
                document.getElementById('projectsList').innerHTML = '<p class="text-red-600 text-center py-8">Configuration error</p>';
                return;
            }

            try {
                const url = `https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/projects.json?ref=${GITHUB_CONFIG.branch}`;
                const response = await fetch(url, {
                    headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const projects = JSON.parse(atob(data.content));
                    
                    if (projects.length === 0) {
                        document.getElementById('projectsList').innerHTML = '<p class="text-gray-500 text-center py-8">No projects yet</p>';
                        return;
                    }

                    displayProjects(projects);
                } else {
                    document.getElementById('projectsList').innerHTML = '<p class="text-gray-500 text-center py-8">No projects yet</p>';
                }
            } catch (error) {
                console.error('Error loading projects:', error);
                document.getElementById('projectsList').innerHTML = '<p class="text-red-600 text-center py-8">Error loading projects</p>';
            }
        }

        function displayProjects(projects) {
            const container = document.getElementById('projectsList');
            
            if (projects.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No projects yet</p>';
                return;
            }

            container.innerHTML = projects.map(project => `
                <div class="border border-gray-200 rounded-lg p-4 flex items-center gap-4 hover:border-primary transition">
                    <div class="flex-shrink-0 w-24 h-24 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg flex items-center justify-center">
                        <svg class="w-12 h-12 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-lg font-semibold text-gray-900 truncate">${escapeHtml(project.title)}</h3>
                        <p class="text-sm text-gray-600 line-clamp-2 mb-2">${escapeHtml(project.description)}</p>
                        <div class="flex flex-wrap gap-2">
                            ${project.tags.map(tag => `
                                <span class="text-xs bg-primary/10 text-primary px-2 py-1 rounded-full">${escapeHtml(tag)}</span>
                            `).join('')}
                        </div>
                    </div>
                    <div class="flex-shrink-0">
                        <button 
                            onclick="deleteProject(${project.id})"
                            class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition flex items-center gap-2"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function deleteProject(projectId) {
            if (!confirm('Are you sure you want to delete this project? This cannot be undone.')) {
                return;
            }

            const GITHUB_CONFIG = getGitHubConfig();
            if (!GITHUB_CONFIG) {
                showManageStatus('Configuration error', 'error');
                return;
            }

            try {
                showManageStatus('Deleting project...', 'info');

                // Get current projects.json
                const url = `https://api.github.com/repos/${GITHUB_CONFIG.repo}/contents/projects.json?ref=${GITHUB_CONFIG.branch}`;
                const response = await fetch(url, {
                    headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` }
                });

                if (!response.ok) {
                    throw new Error('Failed to load projects');
                }

                const data = await response.json();
                const currentSHA = data.sha;
                let projects = JSON.parse(atob(data.content));

                // Remove the project
                const projectToDelete = projects.find(p => p.id === projectId);
                projects = projects.filter(p => p.id !== projectId);

                // Update projects.json
                const newContent = btoa(JSON.stringify(projects, null, 2));
                
                const updateResponse = await fetch(url.split('?')[0], {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Delete project: ${projectToDelete.title}`,
                        content: newContent,
                        sha: currentSHA,
                        branch: GITHUB_CONFIG.branch
                    })
                });

                if (!updateResponse.ok) {
                    throw new Error('Failed to update projects.json');
                }

                showManageStatus('‚úì Project deleted successfully!', 'success');
                
                // Reload the list
                setTimeout(() => {
                    loadProjectsForManagement();
                }, 1000);

            } catch (error) {
                console.error('Delete error:', error);
                showManageStatus('Error: ' + error.message, 'error');
            }
        }

        function showManageStatus(message, type) {
            const statusDiv = document.getElementById('manageStatus');
            
            const colors = {
                success: 'bg-green-50 text-green-800 border border-green-200',
                error: 'bg-red-50 text-red-800 border border-red-200',
                info: 'bg-blue-50 text-blue-800 border border-blue-200'
            };
            
            statusDiv.className = `p-4 rounded-lg ${colors[type] || colors.info}`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 5000);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
